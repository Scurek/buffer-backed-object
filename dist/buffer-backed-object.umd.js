(function(u,U){typeof exports=="object"&&typeof module<"u"?U(exports):typeof define=="function"&&define.amd?define(["exports"],U):(u=typeof globalThis<"u"?globalThis:u||self,U(u["buffer-backed-object"]={}))})(this,(function(u){"use strict";function U(t){return typeof t=="symbol"?!1:!isNaN(t)}function z(t,e){let i=t-t%e;return t%e!=0&&(i+=e),i}function T(t){let e=0;for(const{align:i=1,size:r}of Object.values(t))e=z(e,i)+r;return e=z(e,I(t)),e}function I(t){return Math.max(...Object.values(t).map(e=>e.align??1))}function O(t,e,{byteOffset:i=0,length:r=0,align:n=I(e)}={}){const l=new DataView(t,i);let b=0;const o={...e};for(const[f,c]of Object.entries(o))o[f]={...c,offset:z(b,c.align??1)},b=o[f].offset+c.size;return b=z(b,n),r||(r=Math.floor((t.byteLength-i)/b)),new Proxy(new Array(r),{has(f,c){return U(c)?c<r:c==="buffer"?!0:c in f},get(f,c,J){if(c==="buffer")return t;if(!U(c)){let d=f[c];return typeof d=="function"&&(d=d.bind(J)),d}const B=parseInt(c),h=B*b;if(!(B>=f.length)){if(!f[B]){f[B]={};for(const[d,w]of Object.entries(o))"get"in w&&Object.defineProperty(f[B],d,{enumerable:!0,get(){return w.get(l,h+w.offset)},set(K){return w.set(l,h+w.offset,K)}});Object.freeze(f[B])}return f[B]}}})}function j(t,e,{byteOffset:i=0,align:r=1}={}){return O(t,e,{byteOffset:i,align:r})[0]}function F({endianness:t="little",align:e=2}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const i=t==="little";return{type:"Uint16",align:e,size:Uint16Array.BYTES_PER_ELEMENT,get:(r,n)=>r.getUint16(n,i),set:(r,n,l)=>r.setUint16(n,l,i)}}function g({endianness:t="little",align:e=4}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const i=t==="little";return{type:"Uint32",align:e,size:Uint32Array.BYTES_PER_ELEMENT,get:(r,n)=>r.getUint32(n,i),set:(r,n,l)=>r.setUint32(n,l,i)}}function A({endianness:t="little",align:e=4}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const i=t==="little";return{type:"Uint32",align:e,size:Uint32Array.BYTES_PER_ELEMENT,get:(r,n)=>r.getUint32(n,i)!==0,set:(r,n,l)=>r.setUint32(n,Number(l),i)}}function _({endianness:t="little",align:e=2}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const i=t==="little";return{type:"Int16",align:e,size:Int16Array.BYTES_PER_ELEMENT,get:(r,n)=>r.getInt16(n,i),set:(r,n,l)=>r.setInt16(n,l,i)}}function s({endianness:t="little",align:e=4}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const i=t==="little";return{type:"Int32",align:e,size:Int32Array.BYTES_PER_ELEMENT,get:(r,n)=>r.getInt32(n,i),set:(r,n,l)=>r.setInt32(n,l,i)}}function E({endianness:t="little",align:e=4}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const i=t==="little";return{type:"Float32",align:e,size:Float32Array.BYTES_PER_ELEMENT,get:(r,n)=>r.getFloat32(n,i),set:(r,n,l)=>r.setFloat32(n,l,i)}}function x({endianness:t="little",align:e=8}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const i=t==="little";return{type:"Float64",align:e,size:Float64Array.BYTES_PER_ELEMENT,get:(r,n)=>r.getFloat64(n,i),set:(r,n,l)=>r.setFloat64(n,l,i)}}function S({endianness:t="little",align:e=8}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const i=t==="little";return{type:"BigInt64",align:e,size:BigInt64Array.BYTES_PER_ELEMENT,get:(r,n)=>r.getBigInt64(n,i),set:(r,n,l)=>r.setBigInt64(n,l,i)}}function P({endianness:t="little",align:e=8}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const i=t==="little";return{type:"BigUint64",align:e,size:BigUint64Array.BYTES_PER_ELEMENT,get:(r,n)=>r.getBigUint64(n,i),set:(r,n,l)=>r.setBigUint64(n,l,i)}}function N(){return{type:"Uint8",align:1,size:1,get:(t,e)=>t.getUint8(e),set:(t,e,i)=>t.setUint8(e,i)}}function M(){return{type:"Int8",align:1,size:1,get:(t,e)=>t.getInt8(e),set:(t,e,i)=>t.setInt8(e,i)}}function y(t){const e=T(t);return{type:"NestedBufferBackedObject",align:I(t),size:e,innerDescriptors:t,get:(i,r)=>O(i.buffer,t,{byteOffset:i.byteOffset+r,length:1})[0],set:(i,r,n)=>{throw Error("Cannot set an entire struct")}}}function k(t,e){const i=T(e)*t;return{type:"NestedArrayOfBufferBackedObjects",align:Object.values(e)[0].align??1,size:i,innerDescriptors:e,get:(r,n)=>O(r.buffer,e,{byteOffset:n+r.byteOffset,length:t}),set:(r,n,l)=>{throw Error("Cannot set an entire array")}}}function L(t){return{type:"UTF8String",align:1,size:t,get:(e,i)=>new TextDecoder().decode(new Uint8Array(e.buffer,i,t)).replace(/\u0000+$/,""),set:(e,i,r)=>{const n=new TextEncoder().encode(r),l=new Uint8Array(e.buffer,i,t);l.fill(0),l.set(n.subarray(0,t))}}}function R(t){return{type:"reserved",align:1,size:t,get(){},set(){}}}function Y({endianness:t="little",align:e=4}={}){const i={x:E({endianness:t,align:e}),y:E({endianness:t,align:e})},r=y(i);return{...r,get:(n,l)=>{const b=r.get(n,l);return new Proxy(b,{get(o,f){return f==="r"?o.x:f==="g"?o.y:o[f]},set(o,f,c){return f==="r"?(o.x=c,!0):f==="g"?(o.y=c,!0):(o[f]=c,!0)}})}}}function a({endianness:t="little",align:e=4}={}){const i={x:E({endianness:t,align:e}),y:E({endianness:t,align:e}),z:E({endianness:t,align:e})},r=y(i);return{...r,get:(n,l)=>{const b=r.get(n,l);return new Proxy(b,{get(o,f){return f==="r"?o.x:f==="g"?o.y:f==="b"?o.z:o[f]},set(o,f,c){return f==="r"?(o.x=c,!0):f==="g"?(o.y=c,!0):f==="b"?(o.z=c,!0):(o[f]=c,!0)}})}}}function D({endianness:t="little",align:e=4}={}){const i={x:E({endianness:t,align:e}),y:E({endianness:t,align:e}),z:E({endianness:t,align:e}),w:E({endianness:t,align:e})},r=y(i);return{...r,get:(n,l)=>{const b=r.get(n,l);return new Proxy(b,{get(o,f){return f==="r"?o.x:f==="g"?o.y:f==="b"?o.z:f==="a"?o.w:o[f]},set(o,f,c){return f==="r"?(o.x=c,!0):f==="g"?(o.y=c,!0):f==="b"?(o.z=c,!0):f==="a"?(o.w=c,!0):(o[f]=c,!0)}})}}}function V({endianness:t="little",align:e=4}={}){const i={x:E({endianness:t,align:e}),y:E({endianness:t,align:e}),z:E({endianness:t,align:e}),w:E({endianness:t,align:e})},r=y(i);return{...r,get:(n,l)=>{const b=r.get(n,l);return[b.x,b.y,b.z,b.w]},set(n,l,b){r.set(n,l,{x:b[0],y:b[1],z:b[2],w:b[3]})}}}function m({endianness:t="little",align:e=4}={}){return y({x:g({endianness:t,align:e}),y:g({endianness:t,align:e})})}function C({endianness:t="little",align:e=4}={}){return y({x:g({endianness:t,align:e}),y:g({endianness:t,align:e}),z:g({endianness:t,align:e})})}function $({endianness:t="little",align:e=4}={}){return y({x:g({endianness:t,align:e}),y:g({endianness:t,align:e}),z:g({endianness:t,align:e}),w:g({endianness:t,align:e})})}function q({endianness:t="little",align:e=4}={}){return y({x:s({endianness:t,align:e}),y:s({endianness:t,align:e})})}function G({endianness:t="little",align:e=4}={}){return y({x:s({endianness:t,align:e}),y:s({endianness:t,align:e}),z:s({endianness:t,align:e})})}function H({endianness:t="little",align:e=4}={}){return y({x:s({endianness:t,align:e}),y:s({endianness:t,align:e}),z:s({endianness:t,align:e}),w:s({endianness:t,align:e})})}u.ArrayOfBufferBackedObjects=O,u.BigInt64=S,u.BigUint64=P,u.BoolUint32=A,u.BufferBackedObject=j,u.Float32=E,u.Float32Vec4=V,u.Float32x2=Y,u.Float32x3=a,u.Float32x4=D,u.Float64=x,u.Int16=_,u.Int32=s,u.Int32x2=q,u.Int32x3=G,u.Int32x4=H,u.Int8=M,u.NestedArrayOfBufferBackedObjects=k,u.NestedBufferBackedObject=y,u.UTF8String=L,u.Uint16=F,u.Uint32=g,u.Uint32x2=m,u.Uint32x3=C,u.Uint32x4=$,u.Uint8=N,u.nextAlign=z,u.reserved=R,u.structAlign=I,u.structSize=T,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})}));
