(function(l,B){typeof exports=="object"&&typeof module<"u"?B(exports):typeof define=="function"&&define.amd?define(["exports"],B):(l=typeof globalThis<"u"?globalThis:l||self,B(l["buffer-backed-object"]={}))})(this,(function(l){"use strict";function B(t){return typeof t=="symbol"?!1:!isNaN(t)}function z(t,e){let n=t-t%e;return t%e!=0&&(n+=e),n}function j(t){let e=0;for(const{align:n=1,size:r}of Object.values(t))e=z(e,n)+r;return e=z(e,I(t)),e}function I(t){return Math.max(...Object.values(t).map(e=>e.align??1))}function d(t,e,{byteOffset:n=0,length:r=0,align:i=I(e)}={}){const u=new DataView(t,n);let f=0;const o={...e};for(const[c,b]of Object.entries(o))o[c]={...b,offset:z(f,b.align??1)},f=o[c].offset+b.size;return f=z(f,i),r||(r=Math.floor((t.byteLength-n)/f)),new Proxy(new Array(r),{has(c,b){return B(b)?b<r:b==="buffer"?!0:b in c},get(c,b,O){if(b==="buffer")return t;if(!B(b)){const h=Reflect.get(c,b,O);return typeof h=="function"?h.bind(O):h}const U=parseInt(b),T=U*f;if(!(U>=c.length)){if(!c[U]){c[U]={};for(const[h,w]of Object.entries(o))"get"in w&&Object.defineProperty(c[U],h,{enumerable:!0,get(){return w.get(u,T+w.offset)},set(X){return w.set(u,T+w.offset,X)}});Object.freeze(c[U])}return c[U]}}})}function F(t,e,{byteOffset:n=0,align:r=1}={}){return d(t,e,{byteOffset:n,align:r})[0]}function A({endianness:t="little",align:e=2}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const n=t==="little";return{type:"Uint16",align:e,size:Uint16Array.BYTES_PER_ELEMENT,get:(r,i)=>r.getUint16(i,n),set:(r,i,u)=>r.setUint16(i,u,n)}}function E({endianness:t="little",align:e=4}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const n=t==="little";return{type:"Uint32",align:e,size:Uint32Array.BYTES_PER_ELEMENT,get:(r,i)=>r.getUint32(i,n),set:(r,i,u)=>r.setUint32(i,u,n)}}function x({endianness:t="little",align:e=4}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const n=t==="little";return{type:"Uint32",align:e,size:Uint32Array.BYTES_PER_ELEMENT,get:(r,i)=>r.getUint32(i,n)!==0,set:(r,i,u)=>r.setUint32(i,Number(u),n)}}function _({endianness:t="little",align:e=2}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const n=t==="little";return{type:"Int16",align:e,size:Int16Array.BYTES_PER_ELEMENT,get:(r,i)=>r.getInt16(i,n),set:(r,i,u)=>r.setInt16(i,u,n)}}function y({endianness:t="little",align:e=4}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const n=t==="little";return{type:"Int32",align:e,size:Int32Array.BYTES_PER_ELEMENT,get:(r,i)=>r.getInt32(i,n),set:(r,i,u)=>r.setInt32(i,u,n)}}function g({endianness:t="little",align:e=4}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const n=t==="little";return{type:"Float32",align:e,size:Float32Array.BYTES_PER_ELEMENT,get:(r,i)=>r.getFloat32(i,n),set:(r,i,u)=>r.setFloat32(i,u,n)}}function S({endianness:t="little",align:e=8}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const n=t==="little";return{type:"Float64",align:e,size:Float64Array.BYTES_PER_ELEMENT,get:(r,i)=>r.getFloat64(i,n),set:(r,i,u)=>r.setFloat64(i,u,n)}}function P({endianness:t="little",align:e=8}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const n=t==="little";return{type:"BigInt64",align:e,size:BigInt64Array.BYTES_PER_ELEMENT,get:(r,i)=>r.getBigInt64(i,n),set:(r,i,u)=>r.setBigInt64(i,u,n)}}function N({endianness:t="little",align:e=8}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const n=t==="little";return{type:"BigUint64",align:e,size:BigUint64Array.BYTES_PER_ELEMENT,get:(r,i)=>r.getBigUint64(i,n),set:(r,i,u)=>r.setBigUint64(i,u,n)}}function M(){return{type:"Uint8",align:1,size:1,get:(t,e)=>t.getUint8(e),set:(t,e,n)=>t.setUint8(e,n)}}function k(){return{type:"Int8",align:1,size:1,get:(t,e)=>t.getInt8(e),set:(t,e,n)=>t.setInt8(e,n)}}function s(t){const e=j(t);return{type:"NestedBufferBackedObject",align:I(t),size:e,innerDescriptors:t,get:(n,r)=>d(n.buffer,t,{byteOffset:n.byteOffset+r,length:1})[0],set:(n,r,i)=>{throw Error("Cannot set an entire struct")}}}function L(t,e){const n=j(e)*t;return{type:"NestedArrayOfBufferBackedObjects",align:Object.values(e)[0].align??1,size:n,innerDescriptors:e,get:(r,i)=>d(r.buffer,e,{byteOffset:i+r.byteOffset,length:t}),set:(r,i,u)=>{throw Error("Cannot set an entire array")}}}function R(t){return{type:"UTF8String",align:1,size:t,get:(e,n)=>new TextDecoder().decode(new Uint8Array(e.buffer,n,t)).replace(/\u0000+$/,""),set:(e,n,r)=>{const i=new TextEncoder().encode(r),u=new Uint8Array(e.buffer,n,t);u.fill(0),u.set(i.subarray(0,t))}}}function Y(t){return{type:"reserved",align:1,size:t,get(){},set(){}}}function V({endianness:t="little",align:e=4}={}){const n={x:g({endianness:t,align:e}),y:g({endianness:t,align:e})},r=s(n);return{...r,get:(i,u)=>{const f=r.get(i,u);return new Proxy(f,{get(o,c){return c==="r"?o.x:c==="g"?o.y:o[c]},set(o,c,b){return c==="r"?(o.x=b,!0):c==="g"?(o.y=b,!0):(o[c]=b,!0)}})}}}function D({endianness:t="little",align:e=4}={}){const n={x:g({endianness:t,align:e}),y:g({endianness:t,align:e}),z:g({endianness:t,align:e})},r=s(n);return{...r,get:(i,u)=>{const f=r.get(i,u);return new Proxy(f,{get(o,c){return c==="r"?o.x:c==="g"?o.y:c==="b"?o.z:o[c]},set(o,c,b){return c==="r"?(o.x=b,!0):c==="g"?(o.y=b,!0):c==="b"?(o.z=b,!0):(o[c]=b,!0)}})}}}function m({endianness:t="little",align:e=4}={}){const n={x:g({endianness:t,align:e}),y:g({endianness:t,align:e}),z:g({endianness:t,align:e}),w:g({endianness:t,align:e})},r=s(n);return{...r,get:(i,u)=>{const f=r.get(i,u);return new Proxy(f,{get(o,c){return c==="r"?o.x:c==="g"?o.y:c==="b"?o.z:c==="a"?o.w:o[c]},set(o,c,b){return c==="r"?(o.x=b,!0):c==="g"?(o.y=b,!0):c==="b"?(o.z=b,!0):c==="a"?(o.w=b,!0):(o[c]=b,!0)}})}}}function C({endianness:t="little",align:e=4}={}){const n={x:g({endianness:t,align:e}),y:g({endianness:t,align:e}),z:g({endianness:t,align:e}),w:g({endianness:t,align:e})},r=s(n);return{...r,get:(i,u)=>{const f=r.get(i,u);return[f.x,f.y,f.z,f.w]},set(i,u,f){const o=r.get(i,u);o.x=f.length>0?f[0]:0,o.y=f.length>1?f[1]:0,o.z=f.length>2?f[2]:0,o.w=f.length>3?f[3]:0}}}function $({endianness:t="little",align:e=4}={}){return s({x:E({endianness:t,align:e}),y:E({endianness:t,align:e})})}function q({endianness:t="little",align:e=4}={}){return s({x:E({endianness:t,align:e}),y:E({endianness:t,align:e}),z:E({endianness:t,align:e})})}function G({endianness:t="little",align:e=4}={}){return s({x:E({endianness:t,align:e}),y:E({endianness:t,align:e}),z:E({endianness:t,align:e}),w:E({endianness:t,align:e})})}function H({endianness:t="little",align:e=4}={}){const n={x:E({endianness:t,align:e}),y:E({endianness:t,align:e}),z:E({endianness:t,align:e}),w:E({endianness:t,align:e})},r=s(n);return{...r,get:(i,u)=>{const f=r.get(i,u);return[f.x,f.y,f.z,f.w]},set(i,u,f){const o=r.get(i,u);o.x=f.length>0?f[0]:0,o.y=f.length>1?f[1]:0,o.z=f.length>2?f[2]:0,o.w=f.length>3?f[3]:0}}}function J({endianness:t="little",align:e=4}={}){return s({x:y({endianness:t,align:e}),y:y({endianness:t,align:e})})}function K({endianness:t="little",align:e=4}={}){return s({x:y({endianness:t,align:e}),y:y({endianness:t,align:e}),z:y({endianness:t,align:e})})}function Q({endianness:t="little",align:e=4}={}){return s({x:y({endianness:t,align:e}),y:y({endianness:t,align:e}),z:y({endianness:t,align:e}),w:y({endianness:t,align:e})})}function W({endianness:t="little",align:e=4}={}){const n={x:y({endianness:t,align:e}),y:y({endianness:t,align:e}),z:y({endianness:t,align:e}),w:y({endianness:t,align:e})},r=s(n);return{...r,get:(i,u)=>{const f=r.get(i,u);return[f.x,f.y,f.z,f.w]},set(i,u,f){const o=r.get(i,u);o.x=f.length>0?f[0]:0,o.y=f.length>1?f[1]:0,o.z=f.length>2?f[2]:0,o.w=f.length>3?f[3]:0}}}l.ArrayOfBufferBackedObjects=d,l.BigInt64=P,l.BigUint64=N,l.BoolUint32=x,l.BufferBackedObject=F,l.Float32=g,l.Float32Vec4=C,l.Float32x2=V,l.Float32x3=D,l.Float32x4=m,l.Float64=S,l.Int16=_,l.Int32=y,l.Int32Vec4=W,l.Int32x2=J,l.Int32x3=K,l.Int32x4=Q,l.Int8=k,l.NestedArrayOfBufferBackedObjects=L,l.NestedBufferBackedObject=s,l.UTF8String=R,l.Uint16=A,l.Uint32=E,l.Uint32Vec4=H,l.Uint32x2=$,l.Uint32x3=q,l.Uint32x4=G,l.Uint8=M,l.nextAlign=z,l.reserved=Y,l.structAlign=I,l.structSize=j,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})}));
